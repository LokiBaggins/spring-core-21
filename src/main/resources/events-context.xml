<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
            http://www.springframework.org/schema/beans/spring-beans.xsd
            http://www.springframework.org/schema/context
            http://www.springframework.org/schema/context/spring-context.xsd
            http://www.springframework.org/schema/util
            http://www.springframework.org/schema/util/spring-util-2.5.xsd
">

    <context:property-placeholder location="auditoria.properties"/>

    <bean id="event1" name="Rogue One" class="ua.epam.spring.hometask.domain.Event"
          p:name="Rogue One: A Star Wars Story"
          p:auditoriums-ref="auditoriumsMap1"
          p:airDates-ref="airDates1"
          p:basePrice="100.00"
          p:rating="MID"
    />
    <bean id="event2" name="Green Mile" class="ua.epam.spring.hometask.domain.Event"
          p:name="Green Mile"
          p:auditoriums-ref="auditoriumsMap2"
          p:airDates-ref="airDates2"
          p:basePrice="100.00"
          p:rating="HIGH"
    />

    <util:map id="auditoriumsMap1" key-type="java.time.LocalDateTime" value-type="ua.epam.spring.hometask.domain.Auditorium" map-class="java.util.TreeMap">
        <entry key="#{T(java.time.LocalDateTime).parse('2017-06-20 10:00', dateTimeFormat)}" value-ref="hall1"/>
        <entry key="#{T(java.time.LocalDateTime).parse('2017-06-20 14:00', dateTimeFormat)}" value-ref="hall1"/>
        <entry key="#{T(java.time.LocalDateTime).parse('2017-06-20 19:00', dateTimeFormat)}" value-ref="hall1"/>
    </util:map>

    <util:map id="auditoriumsMap2" key-type="java.time.LocalDateTime" value-type="ua.epam.spring.hometask.domain.Auditorium" map-class="java.util.TreeMap">
        <entry key-ref="date3" value-ref="hall1"/>
        <entry key-ref="date4" value-ref="hall1"/>
        <entry key-ref="date5" value-ref="hall1"/>
    </util:map>

    <util:set id="airDates1" value-type="java.time.LocalDateTime" set-class="java.util.TreeSet">
        <ref bean="date1"/>
        <ref bean="date2"/>
        <ref bean="date3"/>
    </util:set>

    <util:set id="airDates2" value-type="java.time.LocalDateTime" set-class="java.util.TreeSet">
        <ref bean="date4"/>
        <ref bean="date5"/>
        <ref bean="date6"/>
    </util:set>

    <bean id="hall1" class="ua.epam.spring.hometask.domain.Auditorium"
          p:name="${auditorium1.name}"
          p:numberOfSeats="${auditorium1.number_of_seats}"
          p:vipSeats="#{'${auditorium1.vip_seats}'.split(',')}"
    />
    <bean id="hall2" class="ua.epam.spring.hometask.domain.Auditorium"
          p:name="${auditorium2.name}"
          p:numberOfSeats="${auditorium2.number_of_seats}"
          p:vipSeats="#{'${auditorium2.vip_seats}'.split(',')}"
    />
    <bean id="hall3" class="ua.epam.spring.hometask.domain.Auditorium"
          p:name="${auditorium3.name}"
          p:numberOfSeats="${auditorium3.number_of_seats}"
          p:vipSeats="#{'${auditorium3.vip_seats}'.split(',')}"
    />





    <bean id="dateTimeFormat" class="java.time.format.DateTimeFormatter" factory-method="ofPattern">
        <constructor-arg value="yyyy-MM-dd HH:mm"/>
    </bean>

    <bean id="date1" class="java.time.LocalDateTime" factory-method="parse">
        <constructor-arg value="2017-06-20 10:00"/>
        <constructor-arg ref="dateTimeFormat"/>
    </bean>
    <bean id="date2" class="java.time.LocalDateTime" factory-method="parse">
        <constructor-arg value="2017-06-20 14:00"/>
        <constructor-arg ref="dateTimeFormat"/>
    </bean>
    <bean id="date3" class="java.time.LocalDateTime" factory-method="parse">
        <constructor-arg value="2017-06-20 19:00"/>
        <constructor-arg ref="dateTimeFormat"/>
    </bean>
    <bean id="date4" class="java.time.LocalDateTime" factory-method="parse">
        <constructor-arg value="2017-06-19 10:00"/>
        <constructor-arg ref="dateTimeFormat"/>
    </bean>
    <bean id="date5" class="java.time.LocalDateTime" factory-method="parse">
        <constructor-arg value="2017-06-19 14:00"/>
        <constructor-arg ref="dateTimeFormat"/>
    </bean>
    <bean id="date6" class="java.time.LocalDateTime" factory-method="parse">
        <constructor-arg value="2017-06-19 19:00"/>
        <constructor-arg ref="dateTimeFormat"/>
    </bean>

    <!--TODO: I have failed to make this peace of plague to work =( -->
    <!--<bean id="dateEditor" class="org.springframework.beans.propertyeditors.CustomDateEditor">-->
    <!--<constructor-arg ref="dateTimeFormat"/>-->
    <!--<constructor-arg value="true" />-->
    <!--</bean>-->

    <!--<bean class="org.springframework.beans.factory.config.CustomEditorConfigurer">-->
    <!--<property name="customEditors">-->
    <!--<map>-->
    <!--<entry key="java.time.LocalDateTime">-->
    <!--<ref local="dateTimeFormat" />-->
    <!--</entry>-->
    <!--</map>-->
    <!--</property>-->
    <!--</bean>-->
</beans>